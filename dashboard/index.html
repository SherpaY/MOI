<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Market Opportunity Index - Pest Control Expansion Intelligence</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- ====== TOP NAVIGATION ====== -->
  <nav class="top-nav">
    <div class="nav-brand">
      <h1>Market Opportunity Index</h1>
      <span class="brand-tag">Pest Control</span>
    </div>
    <div class="nav-controls">
      <select class="year-selector" id="yearSelector"></select>
      <div class="view-toggle">
        <button class="active" data-view="composite">Composite</button>
        <button data-view="component">Components</button>
      </div>
    </div>
  </nav>

  <!-- ====== MAIN DASHBOARD ====== -->
  <main class="dashboard-container" id="dashboardPanel">

    <!-- Hero: Score Card + Map -->
    <section class="hero-section">
      <!-- Left: Score Card -->
      <div class="hero-score-card" id="heroCard">
        <div class="hero-placeholder" id="heroPlaceholder">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
            <path d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"/>
          </svg>
          <p>Select a state to view its MOI</p>
        </div>
        <div id="heroContent" style="display:none; width:100%; text-align:center;">
          <div class="hero-state-name" id="heroStateLabel">STATE</div>
          <div class="hero-state-full" id="heroStateFull">Select a State</div>
          <div class="hero-moi-score" id="heroMOI">--</div>
          <div class="hero-moi-label">MOI Score</div>
          <div class="hero-band" id="heroBand">--</div>
          <div class="hero-rank" id="heroRank">Rank: <span>--</span> of 50</div>
          <div class="hero-components" id="heroComponents">
            <div class="hero-comp-item"><span class="comp-label">Market Size</span><span class="comp-value" id="heroMSS">--</span></div>
            <div class="hero-comp-item"><span class="comp-label">Competition</span><span class="comp-value" id="heroCDS">--</span></div>
            <div class="hero-comp-item"><span class="comp-label">Pest Risk</span><span class="comp-value" id="heroPRS">--</span></div>
            <div class="hero-comp-item"><span class="comp-label">Growth</span><span class="comp-value" id="heroGTS">--</span></div>
          </div>
        </div>
      </div>

      <!-- Right: Map -->
      <div class="map-container">
        <h2>U.S. Market Opportunity</h2>
        <p class="map-subtitle">Click a state to drill into its expansion profile</p>
        <div id="us-map"></div>
        <div class="map-legend" id="mapLegend"></div>
      </div>
    </section>

    <!-- Ranked Opportunity Table -->
    <section>
      <div class="section-header">
        <h2>Ranked Opportunity Table</h2>
        <p>All 50 states ranked by composite MOI score</p>
      </div>
      <div class="table-section">
        <div class="table-header">
          <h3 id="tableTitle">50 States - 2025</h3>
          <input type="text" class="table-search" id="tableSearch" placeholder="Search state...">
        </div>
        <div class="table-wrapper">
          <table class="data-table" id="stateTable">
            <thead>
              <tr>
                <th data-col="rank">Rank <span class="sort-icon">▲</span></th>
                <th data-col="state">State <span class="sort-icon">▲</span></th>
                <th data-col="moi">MOI <span class="sort-icon">▲</span></th>
                <th data-col="mss">Market Size <span class="sort-icon">▲</span></th>
                <th data-col="cds">Competition <span class="sort-icon">▲</span></th>
                <th data-col="prs">Pest Risk <span class="sort-icon">▲</span></th>
                <th data-col="gts">Growth <span class="sort-icon">▲</span></th>
                <th data-col="population">Population <span class="sort-icon">▲</span></th>
                <th data-col="pest_firm_count">Firms <span class="sort-icon">▲</span></th>
                <th data-col="comp_density">Per 100K <span class="sort-icon">▲</span></th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Charts -->
    <section>
      <div class="section-header">
        <h2>Analytical Views</h2>
        <p>Multi-dimensional opportunity analysis</p>
      </div>
      <div class="charts-grid">
        <!-- Chart 1: Opportunity Quadrant -->
        <div class="chart-card">
          <h3>Opportunity Quadrant</h3>
          <p class="chart-subtitle">Market Size vs. Competition Density - top-left is ideal</p>
          <div class="chart-canvas-container">
            <canvas id="quadrantChart"></canvas>
          </div>
        </div>

        <!-- Chart 2: Component Breakdown -->
        <div class="chart-card breakdown-card">
          <h3>Component Breakdown</h3>
          <p class="chart-subtitle" id="breakdownSubtitle">Select a state to view weighted contributions</p>
          <div class="breakdown-bar-group" id="breakdownBars">
            <!-- Dynamically populated -->
          </div>
        </div>

        <!-- Chart 3: Competition vs Growth -->
        <div class="chart-card">
          <h3>Competition vs. Growth</h3>
          <p class="chart-subtitle">Identify emerging underpenetrated markets</p>
          <div class="chart-canvas-container">
            <canvas id="scatterChart"></canvas>
          </div>
        </div>

        <!-- Chart 4: MOI Distribution -->
        <div class="chart-card">
          <h3>MOI Distribution</h3>
          <p class="chart-subtitle">Score distribution across all 50 states</p>
          <div class="chart-canvas-container">
            <canvas id="histogramChart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- Pest Activity Intelligence -->
    <section>
      <div class="section-header">
        <h2>Pest Activity Intelligence</h2>
        <p>Orkin 2025 Top 50 city rankings aggregated to state level - identifying where pest demand is highest</p>
      </div>
      <div class="pest-intel-grid">
        <!-- Pest Pressure vs Competition scatter -->
        <div class="chart-card">
          <h3>Opportunity Gap Analysis</h3>
          <p class="chart-subtitle">High pest pressure + low competition = prime expansion target (top-left is ideal)</p>
          <div class="chart-canvas-container">
            <canvas id="pestOpportunityChart"></canvas>
          </div>
        </div>

        <!-- Pest breakdown for selected state -->
        <div class="chart-card pest-breakdown-card">
          <h3>Pest Category Breakdown</h3>
          <p class="chart-subtitle" id="pestBreakdownSubtitle">Select a state to view pest pressure by category</p>
          <div id="pestBreakdownContent">
            <div class="pest-placeholder" id="pestPlaceholder">
              <p>Click a state on the map or table to see its pest activity profile</p>
            </div>
            <div id="pestDetail" style="display:none;">
              <div class="pest-score-header">
                <span class="pest-score-label">Pest Pressure Score</span>
                <span class="pest-score-value" id="pestScoreValue">--</span>
                <span class="pest-score-max">/ 100</span>
              </div>
              <div class="pest-bars" id="pestCategoryBars"></div>
              <div class="pest-cities-section">
                <h4>Top Ranked Cities in State</h4>
                <div id="pestCityList"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Top states by pest pressure -->
        <div class="chart-card pest-ranking-card">
          <h3>Top 15 States by Pest Pressure</h3>
          <p class="chart-subtitle">States with the most Orkin-ranked city appearances</p>
          <div class="chart-canvas-container">
            <canvas id="pestRankingChart"></canvas>
          </div>
        </div>

        <!-- Pest type heatmap table -->
        <div class="chart-card pest-heatmap-card">
          <h3>Pest Pressure by Category</h3>
          <p class="chart-subtitle">Score breakdown across 4 major pest categories (top 20 states)</p>
          <div class="pest-heatmap-wrapper">
            <table class="pest-heatmap-table" id="pestHeatmapTable">
              <thead>
                <tr>
                  <th>State</th>
                  <th>Total</th>
                  <th class="pest-col-mosquito">Mosquitoes</th>
                  <th class="pest-col-bedbug">Bed Bugs</th>
                  <th class="pest-col-termite">Termites</th>
                  <th class="pest-col-rodent">Rodents</th>
                </tr>
              </thead>
              <tbody id="pestHeatmapBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Sources & Methodology -->
    <section>
      <div class="section-header">
        <h2>Sources & Research Methodology</h2>
        <p>How the Market Opportunity Index is calculated</p>
      </div>
      <div class="methodology-grid">
        <div class="methodology-card">
          <h3>Scoring Formula</h3>
          <p>Each state receives a composite MOI score (0-100) calculated as a weighted sum of four normalized component scores:</p>
          <div class="formula-block">
            MOI = (0.35 x Market Size) + (0.30 x Competition) + (0.20 x Pest Risk) + (0.15 x Growth)
          </div>
          <p>Each component is normalized using min-max scaling across all 50 states for the selected year, producing scores from 0 (worst) to 100 (best).</p>
        </div>
        <div class="methodology-card">
          <h3>Component Definitions</h3>
          <ul class="methodology-list">
            <li><strong>Market Size (35%)</strong> - Total addressable market based on state population. Larger populations indicate more potential residential and commercial customers.</li>
            <li><strong>Competition (30%)</strong> - Inverse of pest control firm density per 100K residents. Fewer firms per capita means less saturated markets with more room for new entrants.</li>
            <li><strong>Pest Risk (20%)</strong> - Structural pest vulnerability based on housing age (% of units built before 1994) combined with climate conditions (temperature, humidity, precipitation) that favor pest activity.</li>
            <li><strong>Growth (15%)</strong> - Year-over-year population growth rate. Growing populations drive new housing construction and expanding demand for pest services.</li>
          </ul>
        </div>
        <div class="methodology-card">
          <h3>Data Sources</h3>
          <ul class="methodology-list">
            <li><strong>Population</strong> - U.S. Census Bureau, Population Estimates Program (PEP), Vintage 2025 (released Jan 2026)</li>
            <li><strong>Pest Control Firms</strong> - U.S. Census Bureau, County Business Patterns (CBP), NAICS 561710 (Exterminating and Pest Control Services)</li>
            <li><strong>Housing Age</strong> - U.S. Census Bureau, American Community Survey (ACS) 5-Year Estimates, Table B25034 (Year Structure Built)</li>
            <li><strong>Climate Risk</strong> - Composite index derived from NOAA Climate Normals (temperature, humidity, precipitation) and FEMA National Risk Index</li>
            <li><strong>Population Growth</strong> - Derived from year-over-year Census PEP estimates</li>
            <li><strong>Pest Activity</strong> - Orkin 2025 Top 50 City Rankings for Mosquitoes, Bed Bugs, Termites, and Rodents. Based on new residential treatments performed. Cities aggregated to state level.</li>
          </ul>
        </div>
        <div class="methodology-card">
          <h3>Update Schedule</h3>
          <p>This tool is updated <strong>annually</strong> when new data becomes available:</p>
          <ul class="methodology-list">
            <li><strong>Population</strong> - Census Vintage estimates released each December/January</li>
            <li><strong>Pest Firms</strong> - Census CBP data released approximately April each year (1-2 year lag)</li>
            <li><strong>Housing Age</strong> - ACS 5-Year estimates released each December</li>
            <li><strong>Pest Activity</strong> - Orkin publishes updated city rankings throughout the year by pest category</li>
          </ul>
          <p style="margin-top:8px;font-size:0.85rem;color:var(--text-secondary);">Last updated: February 2026</p>
        </div>
        <div class="methodology-card">
          <h3>Opportunity Bands</h3>
          <ul class="methodology-list band-list">
            <li><span class="band-dot" style="background:#0f766e;"></span> <strong>80-100: High Expansion Opportunity</strong> - Large underserved markets with strong structural demand drivers</li>
            <li><span class="band-dot" style="background:#16a34a;"></span> <strong>60-79: Strong Opportunity</strong> - Favorable market dynamics with manageable competition</li>
            <li><span class="band-dot" style="background:#ca8a04;"></span> <strong>40-59: Moderate Opportunity</strong> - Balanced markets requiring targeted entry strategy</li>
            <li><span class="band-dot" style="background:#ea580c;"></span> <strong>20-39: Competitive / Saturated</strong> - High firm density relative to market size</li>
            <li><span class="band-dot" style="background:#dc2626;"></span> <strong>0-19: Highly Saturated</strong> - Very limited expansion potential under current conditions</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <!-- Tooltip -->
  <div class="map-tooltip" id="mapTooltip">
    <div class="tt-state"></div>
    <div class="tt-moi"></div>
    <div class="tt-row"><span class="tt-label">Market Size</span><span class="tt-value tt-mss"></span></div>
    <div class="tt-row"><span class="tt-label">Competition</span><span class="tt-value tt-cds"></span></div>
    <div class="tt-row"><span class="tt-label">Pest Risk</span><span class="tt-value tt-prs"></span></div>
    <div class="tt-row"><span class="tt-label">Growth</span><span class="tt-value tt-gts"></span></div>
    <div class="tt-row"><span class="tt-label">Firms per 100K</span><span class="tt-value tt-comp"></span></div>
  </div>

  <!-- Libraries -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Application -->
  <script src="data.js"></script>
  <script src="pest_data.js"></script>
  <script src="engine.js"></script>
  <script src="app.js"></script>
</body>
</html>
